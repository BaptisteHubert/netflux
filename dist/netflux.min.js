!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.nf=n():e.nf=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FULLY_CONNECTED=n.WEBRTC=n.WebChannel=void 0;var r=t(1);Object.defineProperty(n,"WebChannel",{enumerable:!0,get:function(){return r.WebChannel}});var i=t(2);Object.defineProperty(n,"WEBRTC",{enumerable:!0,get:function(){return i.WEBRTC}}),Object.defineProperty(n,"FULLY_CONNECTED",{enumerable:!0,get:function(){return i.FULLY_CONNECTED}}),t(12)},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebChannel=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),s=t(2),c=r(s),u=t(9),d=t(10),f=r(d),l=t(11),h=r(l),v=t(6),p=r(v),g=(0,c["default"])(s.MESSAGE_FORMATTER),y=0,m=1,b=2,w=3,C=4,O=5,k=6,P=7,E=9,M=function(){function e(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,e),this.defaults={connector:s.WEBRTC,topology:s.FULLY_CONNECTED},this.settings=Object.assign({},this.defaults,n),this.channels=new Set,this.onJoin,this.joiningPeers=new Set,this.connectWithRequests=new Map,this.topology=this.settings.topology,this.id=this.generateId(),this.myId=this.generateId(),this.buffers=new Map,this.onJoining=function(e){},this.onMessage=function(e,n){},this.onLeaving=function(e){}}return a(e,[{key:"leave",value:function(){var e=g.msg(b,{id:this.myId});this.manager.broadcast(this,e)}},{key:"send",value:function(e){var n=this;g.splitUserMessage(e,y,this.myId,null,function(e){n.manager.broadcast(n,e)})}},{key:"sendTo",value:function(e,n){var t=this;g.splitUserMessage(n,y,this.myId,e,function(n){t.manager.sendTo(e,t,n)})}},{key:"openForJoining",value:function(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=Object.assign({},this.settings,n),r=(0,c["default"])(t.connector,t);return r.open(this.generateKey(),function(n){e.initChannel(n,!1).then(function(n){var t=new p["default"](n.peerId,e.myId);t.intermediaryChannel=n,e.joiningPeers.add(t),n.send(g.msg(w,{manager:e.settings.topology,id:n.peerId,intermediaryId:e.myId})),e.manager.broadcast(e,g.msg(C,{id:n.peerId,intermediaryId:e.myId})),e.manager.add(n).then(function(){return n.send(g.msg(k))})["catch"](function(r){e.manager.broadcast(e,g(O,{id:n.peerId})),e.removeJoiningPeer(t.id)})})}).then(function(n){return e.webRTCOpen=n.socket,{key:n.key,url:n.url}})}},{key:"closeForJoining",value:function(){Reflect.has(this,"webRTCOpen")&&this.webRTCOpen.close()}},{key:"join",value:function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=Object.assign({},this.settings,t),i=(0,c["default"])(r.connector,r);return new Promise(function(t,r){n.onJoin=function(){return t(n)},i.join(e).then(function(e){return n.initChannel(e,!0)})["catch"](r)})}},{key:"isInviting",value:function(){}},{key:"has",value:function(e){var n=!0,t=!1,r=void 0;try{for(var i,o=this.channels[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var a=i.value;if(a.peerId===e)return!0}}catch(s){t=!0,r=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(t)throw r}}return!1}},{key:"sendSrvMsg",value:function(e,n){var t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],i=g.msg(m,{serviceName:e,recepient:n,data:Object.assign({},t)});if(null!==r)return void r.send(i);if(n===this.myId)this.onChannelMessage(null,i);else if(this.isJoining())this.getJoiningPeer(this.myId).intermediaryChannel.send(i);else if(this.hasJoiningPeer(n)){var o=this.getJoiningPeer(n);o.intermediaryId===this.myId?o.intermediaryChannel.send(i):this.manager.sendTo(o.intermediaryId,this,i)}else this.manager.sendTo(n,this,i)}},{key:"onChannelMessage",value:function(e,n){var t=this,r=new TextDecoder,i=new DataView(n),a=i.getUint8(0);if(a===y){var s=function(){var e=i.getUint32(12),o=i.getUint32(2);if(e>g.getMaxMsgByteLength())!function(){var n=i.getUint32(10),a=void 0;t.buffers.has(o)?a=t.buffers.get(o):(a=new Map,t.buffers.set(o,a));var s=i.getUint16(16);if(a.has(n))a.get(n).add(i.buffer,s);else{var c=new h["default"](e,function(e){t.onMessage(o,r.decode(e)),a["delete"](n)});c.add(i.buffer,s),a.set(n,c)}}();else{var a=new Uint8Array(n),s=r.decode(a.subarray(u.USER_MSG_BYTE_OFFSET,a.byteLength));t.onMessage(o,s)}return{v:void 0}}();if("object"===("undefined"==typeof s?"undefined":o(s)))return s.v}else{var d={},f=new Uint8Array(n),l=r.decode(f.subarray(1,f.byteLength));d=JSON.parse(l);var v=void 0;switch(a){case b:this.onLeaving(d.id);var M=!0,T=!1,S=void 0;try{for(var j,_=this.channels[Symbol.iterator]();!(M=(j=_.next()).done);M=!0){var R=j.value;R.peerId===d.id&&this.channels["delete"](R)}}catch(I){T=!0,S=I}finally{try{!M&&_["return"]&&_["return"]()}finally{if(T)throw S}}break;case m:this.myId===d.recepient?(0,c["default"])(d.serviceName,this.settings).onMessage(this,e,d.data):this.sendSrvMsg(d.serviceName,d.recepient,d.data);break;case w:this.topology=d.manager,this.myId=d.id,e.peerId=d.intermediaryId,v=new p["default"](this.myId,e.peerId),v.intermediaryChannel=e,this.addJoiningPeer(v);break;case C:this.addJoiningPeer(new p["default"](d.id,d.intermediaryId));break;case O:this.removeJoiningPeer(d.id);break;case k:this.joinSuccess(this.myId),this.manager.broadcast(this,g.msg(P,{id:this.myId})),this.onJoin();break;case P:this.joinSuccess(d.id),this.onJoining(d.id);break;case E:e.onPong(),delete e.onPong}}}},{key:"onChannelError",value:function(e){console.log("DATA_CHANNEL ERROR: ",e)}},{key:"onChannelClose",value:function(e){console.log("DATA_CHANNEL CLOSE: ",e)}},{key:"initChannel",value:function(e,n){var t=this,r=arguments.length<=2||void 0===arguments[2]?-1:arguments[2];return new Promise(function(i,o){-1===r&&(r=t.generateId());var a=new f["default"](e,t,r);n?(a.config(),a.onPong=function(){return i(a)},e.send("ping")):e.onmessage=function(e){"ping"===e.data&&(a.config(),a.send(g.msg(E)),i(a))}})}},{key:"joinSuccess",value:function(e){var n=this,t=this.getJoiningPeer(e);t.channelsToAdd.forEach(function(e){n.channels.add(e),n.joiningPeers["delete"](t)})}},{key:"getJoiningPeer",value:function(e){var n=!0,t=!1,r=void 0;try{for(var i,o=this.joiningPeers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var a=i.value;if(a.id===e)return a}}catch(s){t=!0,r=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(t)throw r}}throw new Error("Joining peer not found!")}},{key:"addJoiningPeer",value:function(e){if(this.hasJoiningPeer(e.id))throw new Error("Joining peer already exists!");this.joiningPeers.add(e)}},{key:"removeJoiningPeer",value:function(e){this.hasJoiningPeer(e)&&this.joiningPeers["delete"](this.getJoiningPeer(e))}},{key:"isJoining",value:function(){var e=!0,n=!1,t=void 0;try{for(var r,i=this.joiningPeers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o.id===this.myId)return!0}}catch(a){n=!0,t=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(n)throw t}}return!1}},{key:"hasJoiningPeer",value:function(e){var n=!0,t=!1,r=void 0;try{for(var i,o=this.joiningPeers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var a=i.value;if(a.id===e)return!0}}catch(s){t=!0,r=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(t)throw r}}return!1}},{key:"generateKey",value:function(){for(var e=2,n=0,t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r="",i=e+Math.round(Math.random()*n),o=0;i>o;o++)r+=t[Math.round(Math.random()*(t.length-1))];return r}},{key:"generateId",value:function(){for(var e=16777215,n=void 0;;){n=Math.floor(Math.random()*e);var t=!0,r=!1,i=void 0;try{for(var o,a=this.channels[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;s.peerId!==n}}catch(c){r=!0,i=c}finally{try{!t&&a["return"]&&a["return"]()}finally{if(r)throw i}}if(this.myId!==n)break}return n}},{key:"topology",set:function(e){this.settings.topology=e,this.manager=(0,c["default"])(this.settings.topology)},get:function(){return this.settings.topology}}]),e}();n.WebChannel=M},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(v.has(e))return v.get(e);var t=void 0;switch(e){case f:return new c["default"](n);case l:return t=new a["default"],v.set(e,t),t;case h:return t=new d["default"],v.set(e,t),t;default:return null}}Object.defineProperty(n,"__esModule",{value:!0}),n.MESSAGE_FORMATTER=n.FULLY_CONNECTED=n.WEBRTC=void 0,n["default"]=i;var o=t(3),a=r(o),s=t(7),c=r(s),u=t(9),d=r(u),f=n.WEBRTC="WebRTCService",l=n.FULLY_CONNECTED="FullyConnectedService",h=n.MESSAGE_FORMATTER="MessageFormatterService",v=new Map},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),c=t(4),u=r(c),d=function(e){function n(){return i(this,n),o(this,Object.getPrototypeOf(n).apply(this,arguments))}return a(n,e),s(n,[{key:"add",value:function(e){var n=e.webChannel,t=[n.myId];return n.channels.forEach(function(e){t[t.length]=e.peerId}),n.joiningPeers.forEach(function(n){e.peerId!==n.id&&(t[t.length]=n.id)}),this.connectWith(n,e.peerId,e.peerId,t)}},{key:"broadcast",value:function(e,n){var t=!0,r=!1,i=void 0;try{for(var o,a=e.channels[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;s.send(n)}}catch(c){r=!0,i=c}finally{try{!t&&a["return"]&&a["return"]()}finally{if(r)throw i}}}},{key:"sendTo",value:function(e,n,t){var r=!0,i=!1,o=void 0;try{for(var a,s=n.channels[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(c.peerId===e)return void c.send(t)}}catch(u){i=!0,o=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}}},{key:"leave",value:function(e){}}]),n}(u.Interface);n["default"]=d},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function s(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0}),n.Interface=void 0;var c=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),u=t(5),d=i(u),f=t(2),l=r(f),h=t(6),v=r(h),p=1,g=2,y=5e3,m=4,b=5,w=function(e){function n(){return o(this,n),a(this,Object.getPrototypeOf(n).apply(this,arguments))}return s(n,e),c(n,[{key:"onMessage",value:function(e,n,t){var r=this,i=(0,l["default"])(e.settings.connector,e.settings);switch(t.code){case p:t.peers=this.reUseIntermediaryChannelIfPossible(e,t.jpId,t.peers);var o=[];0===t.peers.length?e.sendSrvMsg(this.name,t.sender,{code:g,id:e.myId,failed:o}):!function(){var n=0;t.peers.forEach(function(a){i.connectMeTo(e,a).then(function(n){return e.initChannel(n,!0,a)}).then(function(i){e.getJoiningPeer(t.jpId).toAddList(i),e.sendSrvMsg(r.name,e.myId,{code:b,id:t.jpId,toBeAdded:!0},i),n++,n===t.peers.length&&e.sendSrvMsg(r.name,t.sender,{code:g,id:e.myId,failed:o})})["catch"](function(i){n++,o.push({id:a,reason:i}),n===t.peers.length&&e.sendSrvMsg(r.name,t.sender,{code:g,id:e.myId,failed:o})})})}();break;case g:e.connectWithRequests.get(t.id)(!0);break;case m:var a=e.getJoiningPeer(t.jpId);a.toAddList(a.intermediaryChannel);break;case b:e.hasJoiningPeer(t.id)?a=e.getJoiningPeer(t.id):(a=new v["default"](t.id),e.addJoiningPeer(a)),t.toBeAdded?a.toAddList(this):a.toRemoveList(this)}}},{key:"connectWith",value:function(e,n,t,r){var i=this;return e.sendSrvMsg(this.name,n,{code:p,jpId:t,sender:e.myId,peers:r}),new Promise(function(t,o){e.connectWithRequests.set(n,function(e){e?t():o()}),setTimeout(function(){o("CONNECT_WITH_TIMEOUT")},i.calculateConnectWithTimeout(r.length))})}},{key:"calculateConnectWithTimeout",value:function(e){return e>0?y+Math.log10(e):y}},{key:"reUseIntermediaryChannelIfPossible",value:function(e,n,t){var r=null,i=void 0;return e.isJoining()?(i=e.getJoiningPeer(n),-1!==t.indexOf(i.intermediaryId)&&(r=i.intermediaryId)):-1!==t.indexOf(n)&&(i=e.getJoiningPeer(n),null!==i.intermediaryChannel&&(r=n)),null!==r&&(i.toAddList(i.intermediaryChannel),e.sendSrvMsg(this.name,r,{code:m,jpId:n}),t.splice(t.indexOf(r),1)),t}},{key:"add",value:function(e){throw new Error("Must be implemented by subclass!")}},{key:"broadcast",value:function(e,n){throw new Error("Must be implemented by subclass!")}},{key:"sendTo",value:function(e,n,t){throw new Error("Must be implemented by subclass!")}},{key:"leave",value:function(e){throw new Error("Must be implemented by subclass!")}}]),n}(d.Interface);n.Interface=w},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(){t(this,e)}return r(e,[{key:"name",get:function(){return this.constructor.name}}]),e}();n.Interface=i},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(n,r){t(this,e),this.id=n,this.intermediaryId=r,this.intermediaryChannel=null,this.channelsToAdd=[],this.channelsToRemove=[]}return r(e,[{key:"toAddList",value:function(e){this.channelsToAdd[this.channelsToAdd.length]=e}},{key:"toRemoveList",value:function(e){this.channelsToAdd[this.channelsToAdd.length]=e}}]),e}();n["default"]=i},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),c=t(8),u=r(c),d=function(){function e(){a(this,e),this.connections=new Map}return s(e,[{key:"add",value:function(e){var n=this;this.connections.has(e)||!function(){var t=null,r={promise:null};r.promise=new Promise(function(e,n){Object.defineProperty(r,"pc",{get:function(){return t},set:function(n){t=n,e()}}),setTimeout(n,f,"timeout")}),n.connections.set(e,r)}()}},{key:"remove",value:function(e){this.connections["delete"](e)}},{key:"getPC",value:function(e){return this.connections.get(e).pc}},{key:"setPC",value:function(e,n){this.connections.get(e).pc=n}},{key:"addIceCandidate",value:function(e,n){var t=this.connections.get(e);return t.promise.then(function(){return t.pc.addIceCandidate(n)})}}]),e}(),f=2e3,l=new Map,h=function(e){function n(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,n);var t=i(this,Object.getPrototypeOf(n).call(this));return t.defaults={signaling:"wws://sigver-coastteam.rhcloud.com:8000",iceServers:[{urls:"stun:23.21.150.121"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"webrtcdemo",username:"louis%40mozilla.com"}]},t.settings=Object.assign({},t.defaults,e),t}return o(n,e),s(n,[{key:"open",value:function(e,n){var t=this,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=Object.assign({},this.settings,r);return new Promise(function(r,o){var a=new d,s=void 0;try{s=new window.WebSocket(i.signaling)}catch(c){o(c.message)}s.onopen=function(){try{s.send(JSON.stringify({key:e}))}catch(n){o(n.message)}setTimeout(r,100,{key:e,url:i.signaling,socket:s})},s.onmessage=function(e){var r=JSON.parse(e.data);return Reflect.has(r,"id")&&Reflect.has(r,"data")?(a.add(r.id),void(Reflect.has(r.data,"offer")?t.createPeerConnectionAndAnswer(function(e){return s.send(JSON.stringify({id:r.id,data:{candidate:e}}))},function(e){return s.send(JSON.stringify({id:r.id,data:{answer:e}}))},n,r.data.offer).then(function(e){return a.setPC(r.id,e)})["catch"](function(e){console.error("Answer generation failed: "+e)}):Reflect.has(r.data,"candidate")&&a.addIceCandidate(r.id,t.createIceCandidate(r.data.candidate))["catch"](function(e){console.error("Adding ice candidate failed: "+e)}))):(console.log("Unknown message from the signaling server: "+e.data),void s.close())},s.onclose=function(e){1e3!==e.code&&(console.error("Socket with signaling server "+i.signaling+" has been closed with code "+e.code+": "+e.reason),o(e.reason))}})}},{key:"join",value:function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=Object.assign({},this.settings,t);return new Promise(function(t,i){var o=void 0,a=new WebSocket(r.signaling);a.onopen=function(){n.createPeerConnectionAndOffer(function(e){return a.send(JSON.stringify({data:{candidate:e}}))},function(n){return a.send(JSON.stringify({join:e,data:{offer:n}}))},t).then(function(e){o=e})["catch"](i)},a.onmessage=function(e){try{var t=JSON.parse(e.data);Reflect.has(t,"data")||i("Unknown message from the signaling server: "+e.data),Reflect.has(t.data,"answer")?o.setRemoteDescription(n.createSessionDescription(t.data.answer))["catch"](i):Reflect.has(t.data,"candidate")?o.addIceCandidate(n.createIceCandidate(t.data.candidate))["catch"](function(e){console.error("Adding candidate failed: ",e)}):i("Unknown message from the signaling server: "+e.data)}catch(r){i(r.message)}},a.onerror=function(e){i("WebSocket with signaling server error")},a.onclose=function(e){1e3!==e.code&&i("Socket with signaling server "+r.signaling+" has been closed with code "+e.code+": "+e.reason)}})}},{key:"connectMeTo",value:function(e,n){var t=this;return new Promise(function(r,i){var o=e.myId,a=t.getPendingConnections(e);a.add(n),t.createPeerConnectionAndOffer(function(r){return e.sendSrvMsg(t.name,n,{sender:o,candidate:r})},function(r){return e.sendSrvMsg(t.name,n,{sender:o,offer:r})},function(e){a.remove(n),r(e)}).then(function(e){return a.setPC(n,e)}),setTimeout(i,f,"Timeout")})}},{key:"onMessage",value:function(e,n,t){var r=this,i=this.getPendingConnections(e);i.add(t.sender),Reflect.has(t,"offer")&&this.createPeerConnectionAndAnswer(function(n){return e.sendSrvMsg(r.name,t.sender,{sender:e.myId,candidate:n})},function(n){return e.sendSrvMsg(r.name,t.sender,{sender:e.myId,answer:n})},function(n){e.initChannel(n,!1,t.sender),i.remove(n.peerId)},t.offer).then(function(e){i.setPC(t.sender,e)}),Reflect.has(t,"answer")?i.getPC(t.sender).setRemoteDescription(this.createSessionDescription(t.answer))["catch"](function(e){console.error("Setting answer error: "+e)}):Reflect.has(t,"candidate")&&i.addIceCandidate(t.sender,this.createIceCandidate(t.candidate))["catch"](function(e){console.error("Setting candidate error: "+e)})}},{key:"createPeerConnectionAndOffer",value:function(e,n,t){var r=this.createPeerConnection(e),i=r.createDataChannel(null);return r.oniceconnectionstatechange=function(){"disconnected"===r.iceConnectionState&&i.onclose()},i.onopen=function(e){return t(i)},r.createOffer().then(function(e){return r.setLocalDescription(e)}).then(function(){return n(r.localDescription.toJSON()),r})}},{key:"createPeerConnectionAndAnswer",value:function(e,n,t,r){var i=this.createPeerConnection(e);return i.ondatachannel=function(e){var n=e.channel;i.oniceconnectionstatechange=function(){"disconnected"===i.iceConnectionState&&n.onclose()},n.onopen=function(e){return t(n)}},i.setRemoteDescription(this.createSessionDescription(r)).then(function(){return i.createAnswer()}).then(function(e){return i.setLocalDescription(e)}).then(function(){return n(i.localDescription.toJSON()),i})}},{key:"createPeerConnection",value:function(e){var n=new RTCPeerConnection({iceServers:this.settings.iceServers});return n.onicecandidate=function(n){if(null!==n.candidate){var t={candidate:n.candidate.candidate,sdpMLineIndex:n.candidate.sdpMLineIndex};e(t)}},n}},{key:"createIceCandidate",value:function(e){return new RTCIceCandidate(e)}},{key:"createSessionDescription",value:function(e){return Object.assign(new RTCSessionDescription,e)}},{key:"getPendingConnections",value:function(e){if(l.has(e.id))return l.get(e.id);var n=new d;return l.set(e.id,n),n}}]),n}(u.Interface);n["default"]=h},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0}),n.Interface=void 0;var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),c=t(5),u=r(c),d=function(e){function n(){return i(this,n),o(this,Object.getPrototypeOf(n).apply(this,arguments))}return a(n,e),s(n,[{key:"open",value:function(e,n,t){throw new Error("Must be implemented by subclass!")}},{key:"join",value:function(e,n){throw new Error("Must be implemented by subclass!")}},{key:"connectMeTo",value:function(e,n){throw new Error("Must be implemented by subclass!")}}]),n}(u.Interface);n.Interface=d},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0}),n.ARRAYBUFFER_TYPE=n.UINT8ARRAY_TYPE=n.STRING_TYPE=n.USER_MSG_BYTE_OFFSET=n.MAX_CHANNEL_MSG_BYTE_SIZE=void 0;var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),c=t(5),u=r(c),d=n.MAX_CHANNEL_MSG_BYTE_SIZE=16384,f=n.USER_MSG_BYTE_OFFSET=18,l=n.STRING_TYPE=100,h=n.UINT8ARRAY_TYPE=101,v=n.ARRAYBUFFER_TYPE=102,p=function(e){function n(){return i(this,n),o(this,Object.getPrototypeOf(n).apply(this,arguments))}return a(n,e),s(n,[{key:"splitUserMessage",value:function(e,n,t,r,i){var o=this.getDataType(e),a=void 0;switch(o){case l:a=(new TextEncoder).encode(e);break;case h:a=e;break;case v:a=new Uint8Array(e);break;default:return}for(var s=this.getMaxMsgByteLength(),c=this.generateMsgId(),u=Math.ceil(a.byteLength/s),d=0;u>d;d++){var p=Math.min(s,a.byteLength-s*d),g=s*d,y=f+p,m=new DataView(new ArrayBuffer(y));m.setUint8(0,n),m.setUint8(1,o),m.setUint32(2,t),m.setUint32(6,r),m.setUint16(10,c),m.setUint32(12,a.byteLength),m.setUint16(16,d);for(var b=new Uint8Array(m.buffer),w=f,C=g;g+p>C;C++)b[w++]=a[C];i(b)}}},{key:"msg",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],t=(new TextEncoder).encode(JSON.stringify(n)),r=new Uint8Array(1+t.length);r[0]=e;var i=1;for(var o in t)r[i++]=t[o];return r}},{key:"getMaxMsgByteLength",value:function(){return d-f}},{key:"generateMsgId",value:function(){var e=16777215;return Math.round(Math.random()*e)}},{key:"getDataType",value:function(e){return"string"==typeof e||e instanceof String?l:e instanceof Uint8Array?h:e instanceof ArrayBuffer?v:0}}]),n}(u.Interface);n["default"]=p},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(n,r,i){t(this,e),n.binaryType="arraybuffer",this.channel=n,this.webChannel=r,this.peerId=i}return r(e,[{key:"config",value:function(){var e=this;this.channel.onmessage=function(n){e.webChannel.onChannelMessage(e,n.data)},this.channel.onerror=function(n){e.webChannel.onChannelError(n)},this.channel.onclose=function(n){e.webChannel.onChannelClose(n)}}},{key:"send",value:function(e){"closed"!==this.channel.readyState&&this.channel.send(e)}},{key:"close",value:function(){this.channel.close()}}]),e}();n["default"]=i},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=t(2),s=r(a),c=t(9),u=(0,s["default"])(a.MESSAGE_FORMATTER),d=function(){function e(n,t){i(this,e),this.totalByteLength=n,this.currentByteLength=0,this.i8array=new Uint8Array(this.totalByteLength),this.action=t}return o(e,[{key:"add",value:function(e,n){var t=u.getMaxMsgByteLength(),r=new Uint8Array(e);this.currentByteLength+=e.byteLength-c.USER_MSG_BYTE_OFFSET;for(var i=n*t,o=c.USER_MSG_BYTE_OFFSET;o<e.byteLength;o++)this.i8array[i++]=r[o];this.currentByteLength===this.totalByteLength&&this.action(this.i8array)}}]),e}();n["default"]=d},function(e,n,t){var r,r;!function i(e,n,t){function o(s,c){if(!n[s]){if(!e[s]){var u="function"==typeof r&&r;if(!c&&u)return r(s,!0);if(a)return a(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(n){var t=e[s][1][n];return o(t?t:n)},f,f.exports,i,e,n,t)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<t.length;s++)o(t[s]);return o}({1:[function(e,n,t){},{}],2:[function(e,n,t){"use strict";!function(){var t=e("./utils").log,r=e("./utils").browserDetails;n.exports.browserDetails=r,n.exports.extractVersion=e("./utils").extractVersion,n.exports.disableLog=e("./utils").disableLog,e("./utils").disableLog(!0);var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void t("Chrome shim is not included in this adapter release.");t("adapter.js shimming chrome."),n.exports.browserShim=i,i.shimGetUserMedia(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void t("Firefox shim is not included in this adapter release.");t("adapter.js shimming firefox."),n.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void t("MS edge shim is not included in this adapter release.");t("adapter.js shimming edge."),n.exports.browserShim=o,o.shimPeerConnection();break;case"safari":if(!s)return void t("Safari shim is not included in this adapter release.");t("adapter.js shimming safari."),n.exports.browserShim=s,s.shimGetUserMedia();break;default:t("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":1,"./firefox/firefox_shim":5,"./safari/safari_shim":7,"./utils":8}],3:[function(e,n,t){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var n=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(t){
var r=new Event("track");r.track=t.track,r.receiver={track:t.track},r.streams=[e.stream],n.dispatchEvent(r)}),e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&URL.revokeObjectURL(n.src),n.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){n.src&&URL.revokeObjectURL(n.src),n.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,n){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var t=new webkitRTCPeerConnection(e,n),i=t.getStats.bind(t);return t.getStats=function(e,n,t){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,n);var a=function(e){var n={},t=e.result();return t.forEach(function(e){var t={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(n){t[n]=e.stat(n)}),n[t.id]=t}),n};if(arguments.length>=2){var s=function(e){o[1](a(e))};return i.apply(this,[s,arguments[0]])}return new Promise(function(n,t){1===o.length&&"object"==typeof e?i.apply(r,[function(e){n.apply(null,[a(e)])},t]):i.apply(r,[n,t])})},t},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var n=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var n=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var t=arguments,r=this;return t[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(t[0]),new Promise(function(e,i){n.apply(r,[t[0],function(){e(),t.length>=2&&t[1].apply(null,[])},function(e){i(e),t.length>=3&&t[2].apply(null,[e])}])})}})},attachMediaStream:function(e,n){r("DEPRECATED, attachMediaStream will soon be removed."),i.version>=43?e.srcObject=n:"undefined"!=typeof e.src?e.src=URL.createObjectURL(n):r("Error attaching stream to element.")},reattachMediaStream:function(e,n){r("DEPRECATED, reattachMediaStream will soon be removed."),i.version>=43?e.srcObject=n.srcObject:e.src=n.src}};n.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils.js":8,"./getusermedia":4}],4:[function(e,n,t){"use strict";var r=e("../utils.js").log;n.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var n={};return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,n){return e?e+n.charAt(0).toUpperCase()+n.slice(1):"deviceId"===n?"sourceId":n};if(void 0!==r.ideal){n.optional=n.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",t)]=r.ideal,n.optional.push(o),o={},o[i("max",t)]=r.ideal,n.optional.push(o)):(o[i("",t)]=r.ideal,n.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[i("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(n.mandatory=n.mandatory||{},n.mandatory[i(e,t)]=r[e])})}}),e.advanced&&(n.optional=(n.optional||[]).concat(e.advanced)),n},n=function(n,t,i){return n=JSON.parse(JSON.stringify(n)),n.audio&&(n.audio=e(n.audio)),n.video&&(n.video=e(n.video)),r("chrome: "+JSON.stringify(n)),navigator.webkitGetUserMedia(n,t,i)};navigator.getUserMedia=n;var t=function(e){return new Promise(function(n,t){navigator.getUserMedia(e,n,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:t,enumerateDevices:function(){return new Promise(function(e){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(t){e(t.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var i=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return n&&(r("spec:   "+JSON.stringify(n)),n.audio=e(n.audio),n.video=e(n.video),r("chrome: "+JSON.stringify(n))),i(n)}.bind(this)}else navigator.mediaDevices.getUserMedia=function(e){return t(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":8}],5:[function(e,n,t){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails,o={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,n){if(i.version<38&&e&&e.iceServers){for(var t=[],r=0;r<e.iceServers.length;r++){var o=e.iceServers[r];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),t.push(s)}else t.push(e.iceServers[r])}e.iceServers=t}return new mozRTCPeerConnection(e,n)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var n=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}})},shimGetUserMedia:function(){var e=function(e,n,t){var o=function(e){if("object"!=typeof e||e.require)return e;var n=[];return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r=e[t]="object"==typeof e[t]?e[t]:{ideal:e[t]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||n.push(t),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[t]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[t]={min:r.ideal,max:r.ideal}:i[t]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[t]}}}),n.length&&(e.require=n),e};return e=JSON.parse(JSON.stringify(e)),i.version<38&&(r("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),r("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,n,t)};navigator.getUserMedia=e;var n=function(e){return new Promise(function(n,t){navigator.getUserMedia(e,n,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var n=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(n)})},i.version<41){var t=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}},attachMediaStream:function(e,n){r("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=n},reattachMediaStream:function(e,n){r("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=n.srcObject}};n.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils":8,"./getusermedia":6}],6:[function(e,n,t){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;n.exports=function(){var e=function(e,n,t){var o=function(e){if("object"!=typeof e||e.require)return e;var n=[];return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r=e[t]="object"==typeof e[t]?e[t]:{ideal:e[t]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||n.push(t),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[t]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[t]={min:r.ideal,max:r.ideal}:i[t]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[t]}}}),n.length&&(e.require=n),e};return e=JSON.parse(JSON.stringify(e)),i.version<38&&(r("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),r("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,n,t)};navigator.getUserMedia=e;var n=function(e){return new Promise(function(n,t){navigator.getUserMedia(e,n,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var n=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(n)})},i.version<41){var t=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}},{"../utils":8}],7:[function(e,n,t){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};n.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],8:[function(e,n,t){"use strict";var r=!1,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,n,t){var r=e.match(n);return r&&r.length>=t&&parseInt(r[t],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,e.minVersion=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),e.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),e.minVersion=38;else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),e.minVersion=602}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547}return e.version<e.minVersion&&i.log("Browser: "+e.browser+" Version: "+e.version+" < minimum supported version: "+e.minVersion+"\n some things might not work!"),e}};n.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])}])});